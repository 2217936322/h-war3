globals
	trigger m1_Trigger_MHAttack
	trigger m1_Trigger_HeroLevelUp
	trigger m1_Trigger_HeroStudySkill
	trigger m1_Trigger_HeroDeath
	trigger m1_Trigger_HeroApm

	trigger m1_Trigger_HeroTomb
	trigger m1_Trigger_HeroReborn

	/* 地穴甲虫 */
	integer m1_Spell_Shitf_CryptBeetle_Q_ChuanCi = 'A017'			//穿刺
	integer m1_Spell_Shitf_CryptBeetle_W_ZuanDi = 'A02I'			//钻地
	integer m1_Spell_Shitf_CryptBeetle_E_FuShiChongYe = 'A02J'		//腐蚀虫液
	integer m1_Spell_Shitf_CryptBeetle_R_TuiKe = 'A02L'				//蜕壳
	integer m1_Spell_Shitf_CryptBeetle_D_JianCiWaiKe = 'A030'		//尖刺外壳

	/* 影刺客 */
	integer m1_Spell_Shitf_ArcaneHunter_Q_TuXi = 'A02M'				//突袭
	integer m1_Spell_Shitf_ArcaneHunter_W_ShaBei = 'A02N'			//杀背
	integer m1_Spell_Shitf_ArcaneHunter_E_AnShaLingYu = 'A02P'		//暗杀领域
	integer m1_Spell_Shitf_ArcaneHunter_R_TianZhu = 'A02Q'			//天诛
	integer m1_Spell_Shitf_ArcaneHunter_D_JiYeHeiYing = 'A02R'		//极夜黑影

	/* 恶魔猎手 */
	integer m1_Spell_Shitf_DemonHunter_Q_EGui = 'A03A'						//恶鬼
	integer m1_Spell_Shitf_DemonHunter_W_HenNianChanShen = 'A03B'		//恨念缠身
	integer m1_Spell_Shitf_DemonHunter_E_GuiYing = 'A03M'					//鬼影
	integer m1_Spell_Shitf_DemonHunter_R_GuiYingChongChong = 'A03N'		//鬼影重重
	integer m1_Spell_Shitf_DemonHunter_D_CanYingQieGe = 'A03Q'				//残影切割

	/* 无双 */
	integer m1_Spell_Shitf_Unparalleled_Q_HuoYanLianZhan = 'A03U'		//火焰连斩
	integer m1_Spell_Shitf_Unparalleled_W_WeiWu = 'A03Y'					//威武
	integer m1_Spell_Shitf_Unparalleled_E_TianXiaWuShuang = 'A03Z'		//天下无双
	integer m1_Spell_Shitf_Unparalleled_R_QianJunPo = 'A041'				//千军破
	integer m1_Spell_Shitf_Unparalleled_D_HuoQiLuanWu = 'A042'			//火气乱舞

	/* 暗杀者 */
	integer m1_Spell_Shitf_Assassin_Q_FenShen = 'A048'			//分身
	integer m1_Spell_Shitf_Assassin_W_ShanShuo = 'A043'		//闪烁
	integer m1_Spell_Shitf_Assassin_E_QiangLieGongJi = 'A045'	//强烈攻击
	integer m1_Spell_Shitf_Assassin_R_ShunShaXiuLian = 'A044'	//瞬杀修炼
	integer m1_Spell_Shitf_Assassin_D_YiJi = 'A046'				//一击

	/* 逸风 */
	integer m1_Spell_Shitf_Wind_Q_YiCha = 'A00W'				//一刹
	integer m1_Spell_Shitf_Wind_W_XunShou = 'A0AV'			//迅手
	integer m1_Spell_Shitf_Wind_E_WuYingZhan = 'A0AW'		//无影斩
	integer m1_Spell_Shitf_Wind_R_WuYingZhanFeng = 'A0AX'	//无影斩风
	integer m1_Spell_Shitf_Wind_D_JiJiJianSha = 'A0B3'			//疾疾剑刹

	/* 霹雳 */
	integer m1_Spell_Shitf_ThunderBolt_Q_DianGuangHuoShi = 'A04A'	//电光火石
	integer m1_Spell_Shitf_ThunderBolt_W_JingXiaPiLi = 'A04B'			//惊吓霹雳
	integer m1_Spell_Shitf_ThunderBolt_E_LiZiChongNeng = 'A04F'		//离子充能
	integer m1_Spell_Shitf_ThunderBolt_R_DianChuanDao = 'A04H'		//电传导
	integer m1_Spell_Shitf_ThunderBolt_D_LeiQu = 'A04I'				//雷区

	/* 召唤师 */
	integer m1_Spell_Shitf_Keal_Q_MingXiang = 'A058'			//冥想
	integer m1_Spell_Shitf_Keal_W_XianJiJingLing = 'A05W'		//献祭精灵
	integer m1_Spell_Shitf_Keal_E_WangZheHusheng = 'A05Y'	//亡者呼声
	integer m1_Spell_Shitf_Keal_R_YiNianZuZhou = 'A061'		//意念诅咒
	integer m1_Spell_Shitf_Keal_D_KongMing = 'A064'			//空冥

	/* 德鲁伊法尔 */
	integer m1_Spell_Shitf_DruidFarre_Q_ZhiLiaoBo = 'A06F'			//治疗波
	integer m1_Spell_Shitf_DruidFarre_W_ShenShengPiLi = 'A065'	//神圣霹雳
	integer m1_Spell_Shitf_DruidFarre_E_ChengFeng = 'A068'		//乘风
	integer m1_Spell_Shitf_DruidFarre_R_ZhiHuiZhiLi = 'A06D'		//智慧之力
	integer m1_Spell_Shitf_DruidFarre_D_HuiGui = 'A06I'				//回归

	/* 美杜莎 */
	integer m1_Spell_Shitf_Medusa_Q_BingHanZhiShi = 'A06Z'		//冰寒之矢
	integer m1_Spell_Shitf_Medusa_W_ShuiYaoZhiBi = 'A07F'		//水妖之壁
	integer m1_Spell_Shitf_Medusa_E_ShuiHuaZhiWu = 'A073'		//水花之舞
	integer m1_Spell_Shitf_Medusa_R_MiWuShiHua = 'A07B'			//迷雾石化
	integer m1_Spell_Shitf_Medusa_D_ShenHaiHexin = 'A06U'		//深海核心

	/* 山丘之王 */
	integer m1_Spell_Shitf_MountainKing_Q_WuXingZhiChui = 'A087'	//无形之锤
	integer m1_Spell_Shitf_MountainKing_W_ChuiJi = 'A088'				//锤击
	integer m1_Spell_Shitf_MountainKing_E_BuFanZhongJi = 'A089'		//不凡重击
	integer m1_Spell_Shitf_MountainKing_R_TianShenXiaFan = 'A085'	//天神下凡
	integer m1_Spell_Shitf_MountainKing_D_LianChuiWu = 'A083'		//连锤舞

	/* 捍卫骑士 */
	integer m1_Spell_Shitf_ProtectKnight_Q_YuShu = 'A092'					//愈术
	integer m1_Spell_Shitf_ProtectKnight_W_ShouWeiLingYu = 'A08T'		//守卫领域
	integer m1_Spell_Shitf_ProtectKnight_E_ZhanZhengHaoJiao = 'A08W'		//战争号角
	integer m1_Spell_Shitf_ProtectKnight_R_GuangMingPao = 'A08S'			//光明炮
	integer m1_Spell_Shitf_ProtectKnight_D_ShengGuangZhu = 'A09E'		//圣光柱

	/* 撼地蛮牛 */
	integer m1_Spell_Shitf_ShakeBull_Q_JianTa = 'A09I'			//践踏
	integer m1_Spell_Shitf_ShakeBull_W_TuWei = 'A09K'			//突围
	integer m1_Spell_Shitf_ShakeBull_E_ZhenDangBo = 'A09L'	//震荡波
	integer m1_Spell_Shitf_ShakeBull_R_CanYingTA = 'A09J'		//残影踏
	integer m1_Spell_Shitf_ShakeBull_D_ZhenHanDaDi = 'A0AE'	//震撼大地

	/* 死亡骑士 */
	integer m1_Spell_Shitf_DeathKnight_Q_YuanQiZhan = 'A0AH'		//怨气斩
	integer m1_Spell_Shitf_DeathKnight_W_JiuShu = 'A0AI'				//救赎
	integer m1_Spell_Shitf_DeathKnight_E_FanKangMingYun = 'A0AQ'	//反抗命运
	integer m1_Spell_Shitf_DeathKnight_R_HuiGuangFanZhao = 'A0AS'	//回光返照
	integer m1_Spell_Shitf_DeathKnight_D_DuoLuo = 'A0AY'				//堕落

endglobals

library m1Hero requires m1Spell

	/**
	 * 英雄数据
	 */
	private function initHero takes nothing returns nothing
		//-------------------Copy-------------------
		set Max_Hero_Qty = 13
		set Heros[1] = Hero_crypt_beetle
		set Heros[2] = Hero_arcane_hunter
		set Heros[3] = Hero_demon_hunter
		set Heros[4] = Hero_unparalleled
		set Heros[5] = Hero_assassin
		set Heros[6] = Hero_wind
		set Heros[7] = Hero_thunderbolt
		set Heros[8] = Hero_kael
		set Heros[9] = Hero_druid_farre
		set Heros[10] = Hero_medusa
		set Heros[11] = Hero_mountain_king
		set Heros[12] = Hero_protect_knight
		set Heros[13] = Hero_shake_bull
		set Heros[14] = Hero_death_knight

		//地穴甲虫
		call SaveReal( HASH_Hero,Hero_crypt_beetle,Hero_Hash_Key_BeforeAction,0.460)
		call SaveReal( HASH_Hero,Hero_crypt_beetle,Hero_Hash_Key_AfterAction,0.540)
		call SaveReal( HASH_Hero,Hero_crypt_beetle,Hero_Hash_Key_ArrowSpeed,9999.0)
		//影刺客
		call SaveReal( HASH_Hero,Hero_arcane_hunter,Hero_Hash_Key_BeforeAction,0.300)
		call SaveReal( HASH_Hero,Hero_arcane_hunter,Hero_Hash_Key_AfterAction,0.600)
		call SaveReal( HASH_Hero,Hero_arcane_hunter,Hero_Hash_Key_ArrowSpeed,9999.0)
		//恶魔猎手
		call SaveReal( HASH_Hero,Hero_demon_hunter,Hero_Hash_Key_BeforeAction,0.300)
		call SaveReal( HASH_Hero,Hero_demon_hunter,Hero_Hash_Key_AfterAction,0.600)
		call SaveReal( HASH_Hero,Hero_demon_hunter,Hero_Hash_Key_ArrowSpeed,9999.0)
		//无双
		call SaveReal( HASH_Hero,Hero_unparalleled,Hero_Hash_Key_BeforeAction,0.300)
		call SaveReal( HASH_Hero,Hero_unparalleled,Hero_Hash_Key_AfterAction,0.300)
		call SaveReal( HASH_Hero,Hero_unparalleled,Hero_Hash_Key_ArrowSpeed,9999.0)
		//暗杀者
		call SaveReal( HASH_Hero,Hero_assassin,Hero_Hash_Key_BeforeAction,0.300)
		call SaveReal( HASH_Hero,Hero_assassin,Hero_Hash_Key_AfterAction,0.700)
		call SaveReal( HASH_Hero,Hero_assassin,Hero_Hash_Key_ArrowSpeed,9999.0)
		//逸风
		call SaveReal( HASH_Hero,Hero_wind,Hero_Hash_Key_BeforeAction,0.330)
		call SaveReal( HASH_Hero,Hero_wind,Hero_Hash_Key_AfterAction,0.840)
		call SaveReal( HASH_Hero,Hero_wind,Hero_Hash_Key_ArrowSpeed,9999.0)
		//霹雳
		call SaveReal( HASH_Hero,Hero_thunderbolt,Hero_Hash_Key_BeforeAction,0.400)
		call SaveReal( HASH_Hero,Hero_thunderbolt,Hero_Hash_Key_AfterAction,0.770)
		call SaveReal( HASH_Hero,Hero_thunderbolt,Hero_Hash_Key_ArrowSpeed,2000.0)
		//召唤师
		call SaveReal( HASH_Hero,Hero_kael,Hero_Hash_Key_BeforeAction,0.530)
		call SaveReal( HASH_Hero,Hero_kael,Hero_Hash_Key_AfterAction,0.470)
		call SaveReal( HASH_Hero,Hero_kael,Hero_Hash_Key_ArrowSpeed,900.0)
		//德鲁伊法尔
		call SaveReal( HASH_Hero,Hero_druid_farre,Hero_Hash_Key_BeforeAction,0.400)
		call SaveReal( HASH_Hero,Hero_druid_farre,Hero_Hash_Key_AfterAction,0.770)
		call SaveReal( HASH_Hero,Hero_druid_farre,Hero_Hash_Key_ArrowSpeed,1200.0)
		//美杜莎
		call SaveReal( HASH_Hero,Hero_medusa,Hero_Hash_Key_BeforeAction,0.730)
		call SaveReal( HASH_Hero,Hero_medusa,Hero_Hash_Key_AfterAction,0.540)
		call SaveReal( HASH_Hero,Hero_medusa,Hero_Hash_Key_ArrowSpeed,1300.0)
		//山丘之王
		call SaveReal( HASH_Hero,Hero_mountain_king,Hero_Hash_Key_BeforeAction,0.350)
		call SaveReal( HASH_Hero,Hero_mountain_king,Hero_Hash_Key_AfterAction,0.650)
		call SaveReal( HASH_Hero,Hero_mountain_king,Hero_Hash_Key_ArrowSpeed,9999.0)
		//捍卫骑士
		call SaveReal( HASH_Hero,Hero_protect_knight,Hero_Hash_Key_BeforeAction,0.350)
		call SaveReal( HASH_Hero,Hero_protect_knight,Hero_Hash_Key_AfterAction,0.200)
		call SaveReal( HASH_Hero,Hero_protect_knight,Hero_Hash_Key_ArrowSpeed,9999.0)
		//撼地蛮牛
		call SaveReal( HASH_Hero,Hero_shake_bull,Hero_Hash_Key_BeforeAction,0.360)
		call SaveReal( HASH_Hero,Hero_shake_bull,Hero_Hash_Key_AfterAction,0.970)
		call SaveReal( HASH_Hero,Hero_shake_bull,Hero_Hash_Key_ArrowSpeed,9999.0)
		//死亡骑士
		call SaveReal( HASH_Hero,Hero_death_knight,Hero_Hash_Key_BeforeAction,0.560)
		call SaveReal( HASH_Hero,Hero_death_knight,Hero_Hash_Key_AfterAction,0.410)
		call SaveReal( HASH_Hero,Hero_death_knight,Hero_Hash_Key_ArrowSpeed,9999.0)

		    //-------------------Copy END-------------------

		//恶魔猎手 - 邪
		call SaveReal( HASH_Hero, Hero_demon_hunter_sp ,Hero_Hash_Key_BeforeAction,0.300)
		call SaveReal( HASH_Hero, Hero_demon_hunter_sp ,Hero_Hash_Key_AfterAction,0.600)
		call SaveReal( HASH_Hero, Hero_demon_hunter_sp ,Hero_Hash_Key_ArrowSpeed,9999.0)
	endfunction

	/* 酒馆 */
	private function initDrunkery takes nothing returns nothing
		set Drunkery_Human = gg_unit_n015_0001
    	set Drunkery_ORC = gg_unit_n018_0008
   	 	set Drunkery_ABYSS = gg_unit_n019_0005
    	set Drunkery_FOREST = gg_unit_n017_0002
    	set Drunkery_NATURE = gg_unit_n01C_0017
	    //--------------Copy-------------------
		//地穴甲虫 - 深渊酒馆
		call funcs_addUnit2Stock(Drunkery_ABYSS,Hero_crypt_beetle)
		//影刺客 - 人类酒馆
		call funcs_addUnit2Stock(Drunkery_Human,Hero_arcane_hunter)
		//恶魔猎手 - 深渊酒馆
		call funcs_addUnit2Stock(Drunkery_ABYSS,Hero_demon_hunter)
		//无双 - 森林酒馆
		call funcs_addUnit2Stock(Drunkery_FOREST,Hero_unparalleled)
		//暗杀者 - 森林酒馆
		call funcs_addUnit2Stock(Drunkery_FOREST,Hero_assassin)
		//逸风 - 野兽酒馆
		call funcs_addUnit2Stock(Drunkery_ORC,Hero_wind)
		//霹雳 - 森林酒馆
		call funcs_addUnit2Stock(Drunkery_FOREST,Hero_thunderbolt)
		//召唤师 - 深渊酒馆
		call funcs_addUnit2Stock(Drunkery_ABYSS,Hero_kael)
		//德鲁伊法尔 - 森林酒馆
		call funcs_addUnit2Stock(Drunkery_FOREST,Hero_druid_farre)
		//美杜莎 - 自然酒馆
		call funcs_addUnit2Stock(Drunkery_NATURE,Hero_medusa)
		//山丘之王 - 人类酒馆
		call funcs_addUnit2Stock(Drunkery_Human,Hero_mountain_king)
		//捍卫骑士 - 人类酒馆
		call funcs_addUnit2Stock(Drunkery_Human,Hero_protect_knight)
		//撼地蛮牛 - 野兽酒馆
		call funcs_addUnit2Stock(Drunkery_ORC,Hero_shake_bull)
		//死亡骑士 - 深渊酒馆
	    //--------------Copy-END------------------
	endfunction

	/* 技能模板替换 */
	private function spell_shift takes integer index , integer spell returns nothing
		if( Players[index]!=null and Player_heros[index]!=null ) then
			call UnitAddAbility( Player_heros[index] , spell )
			call UnitMakeAbilityPermanent( Player_heros[index] , true , spell )
    		call SetPlayerAbilityAvailable( Players[index] , spell , false )
		endif
	endfunction
	public function initSpellShift takes unit hero returns nothing
		local integer heroTypeId = GetUnitTypeId(hero)
		local integer index = GetConvertedPlayerId(GetOwningPlayer(hero))
		//地穴甲虫
	    if( heroTypeId == Hero_crypt_beetle ) then
			call spell_shift( index , m1_Spell_Shitf_CryptBeetle_Q_ChuanCi )
			call spell_shift( index , m1_Spell_Shitf_CryptBeetle_W_ZuanDi )
			call spell_shift( index , m1_Spell_Shitf_CryptBeetle_E_FuShiChongYe )
			call spell_shift( index , m1_Spell_Shitf_CryptBeetle_R_TuiKe )
			call spell_shift( index , m1_Spell_Shitf_CryptBeetle_D_JianCiWaiKe )
	    endif
	    //影刺客
	    if( heroTypeId == Hero_arcane_hunter ) then
			call spell_shift( index , m1_Spell_Shitf_ArcaneHunter_Q_TuXi )
			call spell_shift( index , m1_Spell_Shitf_ArcaneHunter_W_ShaBei )
			call spell_shift( index , m1_Spell_Shitf_ArcaneHunter_E_AnShaLingYu )
			call spell_shift( index , m1_Spell_Shitf_ArcaneHunter_R_TianZhu )
			call spell_shift( index , m1_Spell_Shitf_ArcaneHunter_D_JiYeHeiYing )
	    endif
	    //恶魔猎手
	    if( heroTypeId == Hero_demon_hunter ) then
			call spell_shift( index , m1_Spell_Shitf_DemonHunter_Q_EGui )
			call spell_shift( index , m1_Spell_Shitf_DemonHunter_W_HenNianChanShen )
			call spell_shift( index , m1_Spell_Shitf_DemonHunter_E_GuiYing )
			call spell_shift( index , m1_Spell_Shitf_DemonHunter_R_GuiYingChongChong )
			call spell_shift( index , m1_Spell_Shitf_DemonHunter_D_CanYingQieGe )
	    endif
	    //无双
	    if( heroTypeId == Hero_unparalleled ) then
			call spell_shift( index , m1_Spell_Shitf_Unparalleled_Q_HuoYanLianZhan )
			call spell_shift( index , m1_Spell_Shitf_Unparalleled_W_WeiWu )
			call spell_shift( index , m1_Spell_Shitf_Unparalleled_E_TianXiaWuShuang )
			call spell_shift( index , m1_Spell_Shitf_Unparalleled_R_QianJunPo )
			call spell_shift( index , m1_Spell_Shitf_Unparalleled_D_HuoQiLuanWu )
	    endif
	    //暗杀者
	    if( heroTypeId == Hero_assassin ) then
			call spell_shift( index , m1_Spell_Shitf_Assassin_Q_FenShen )
			call spell_shift( index , m1_Spell_Shitf_Assassin_W_ShanShuo )
			call spell_shift( index , m1_Spell_Shitf_Assassin_E_QiangLieGongJi )
			call spell_shift( index , m1_Spell_Shitf_Assassin_R_ShunShaXiuLian )
			call spell_shift( index , m1_Spell_Shitf_Assassin_D_YiJi )
	    endif
		//逸风
	    if( heroTypeId == Hero_wind ) then
			call spell_shift( index , m1_Spell_Shitf_Wind_Q_YiCha )
			call spell_shift( index , m1_Spell_Shitf_Wind_W_XunShou )
			call spell_shift( index , m1_Spell_Shitf_Wind_E_WuYingZhan )
			call spell_shift( index , m1_Spell_Shitf_Wind_R_WuYingZhanFeng )
			call spell_shift( index , m1_Spell_Shitf_Wind_D_JiJiJianSha )
	    endif
	    //霹雳
	    if( heroTypeId == Hero_thunderbolt ) then
			call spell_shift( index , m1_Spell_Shitf_ThunderBolt_Q_DianGuangHuoShi )
			call spell_shift( index , m1_Spell_Shitf_ThunderBolt_W_JingXiaPiLi )
			call spell_shift( index , m1_Spell_Shitf_ThunderBolt_E_LiZiChongNeng )
			call spell_shift( index , m1_Spell_Shitf_ThunderBolt_R_DianChuanDao )
			call spell_shift( index , m1_Spell_Shitf_ThunderBolt_D_LeiQu )
	    endif
	    //召唤师
	    if( heroTypeId == Hero_kael ) then
			call spell_shift( index , m1_Spell_Shitf_Keal_Q_MingXiang )
			call spell_shift( index , m1_Spell_Shitf_Keal_W_XianJiJingLing )
			call spell_shift( index , m1_Spell_Shitf_Keal_E_WangZheHusheng )
			call spell_shift( index , m1_Spell_Shitf_Keal_R_YiNianZuZhou )
			call spell_shift( index , m1_Spell_Shitf_Keal_D_KongMing )
	    endif
	    //德鲁伊法尔
	    if( heroTypeId == Hero_druid_farre ) then
			call spell_shift( index , m1_Spell_Shitf_DruidFarre_Q_ZhiLiaoBo )
			call spell_shift( index , m1_Spell_Shitf_DruidFarre_W_ShenShengPiLi )
			call spell_shift( index , m1_Spell_Shitf_DruidFarre_E_ChengFeng )
			call spell_shift( index , m1_Spell_Shitf_DruidFarre_R_ZhiHuiZhiLi )
			call spell_shift( index , m1_Spell_Shitf_DruidFarre_D_HuiGui )
	    endif
	    //美杜莎
	    if( heroTypeId == Hero_medusa ) then
			call spell_shift( index , m1_Spell_Shitf_Medusa_Q_BingHanZhiShi )
			call spell_shift( index , m1_Spell_Shitf_Medusa_W_ShuiYaoZhiBi )
			call spell_shift( index , m1_Spell_Shitf_Medusa_E_ShuiHuaZhiWu )
			call spell_shift( index , m1_Spell_Shitf_Medusa_R_MiWuShiHua )
			call spell_shift( index , m1_Spell_Shitf_Medusa_D_ShenHaiHexin )
	    endif
	    //山丘之王
	    if( heroTypeId == Hero_mountain_king ) then
			call spell_shift( index , m1_Spell_Shitf_MountainKing_Q_WuXingZhiChui )
			call spell_shift( index , m1_Spell_Shitf_MountainKing_W_ChuiJi )
			call spell_shift( index , m1_Spell_Shitf_MountainKing_E_BuFanZhongJi )
			call spell_shift( index , m1_Spell_Shitf_MountainKing_R_TianShenXiaFan )
			call spell_shift( index , m1_Spell_Shitf_MountainKing_D_LianChuiWu )
	    endif
	    //捍卫骑士
	    if( heroTypeId == Hero_protect_knight ) then
			call spell_shift( index , m1_Spell_Shitf_ProtectKnight_Q_YuShu )
			call spell_shift( index , m1_Spell_Shitf_ProtectKnight_W_ShouWeiLingYu )
			call spell_shift( index , m1_Spell_Shitf_ProtectKnight_E_ZhanZhengHaoJiao )
			call spell_shift( index , m1_Spell_Shitf_ProtectKnight_R_GuangMingPao )
			call spell_shift( index , m1_Spell_Shitf_ProtectKnight_D_ShengGuangZhu )
	    endif
		//撼地蛮牛
		if( heroTypeId == Hero_shake_bull ) then
			call spell_shift( index , m1_Spell_Shitf_ShakeBull_Q_JianTa )
			call spell_shift( index , m1_Spell_Shitf_ShakeBull_W_TuWei )
			call spell_shift( index , m1_Spell_Shitf_ShakeBull_E_ZhenDangBo )
			call spell_shift( index , m1_Spell_Shitf_ShakeBull_R_CanYingTA )
			call spell_shift( index , m1_Spell_Shitf_ShakeBull_D_ZhenHanDaDi )
	    endif
		//死亡骑士
		if( heroTypeId == Hero_death_knight ) then
			call spell_shift( index , m1_Spell_Shitf_DeathKnight_Q_YuanQiZhan )
			call spell_shift( index , m1_Spell_Shitf_DeathKnight_W_JiuShu )
			call spell_shift( index , m1_Spell_Shitf_DeathKnight_E_FanKangMingYun )
			call spell_shift( index , m1_Spell_Shitf_DeathKnight_R_HuiGuangFanZhao )
			call spell_shift( index , m1_Spell_Shitf_DeathKnight_D_DuoLuo )
	    endif
	endfunction

	/* 天赋技能 */
	private function talent_eagle_eye takes nothing returns nothing 	//鹰眼
		//nothing
	endfunction
	private function talent_charge takes nothing returns nothing		//冲锋
		local unit u = GetTriggerUnit()
	    local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	    local integer index = GetConvertedPlayerId(GetOwningPlayer(u))
	    local real facing = GetUnitFacing(u)
	    local real speed = I2R(level)+19
	    local real hunt = I2R(level) * 30
	    local real range = 75
	    local real distance = 250 + I2R(level) * 50
	    call SetUnitVertexColorBJ( u, 100, 100, 100, 95.00 )
	    call skills_charge(u,facing,distance,speed,SKILL_CHARGE_CRASH,null,hunt,range,Effect_red_shatter,false)
	endfunction
	private function talent_jump takes nothing returns nothing			//跳跃
		local unit u = GetTriggerUnit()
		local unit targetUnit = GetSpellTargetUnit()
	    local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	    local real speed = I2R(level)+34
	    call SetUnitVertexColorBJ( u, 100, 100, 100, 95.00 )
	    call skills_jump( u , targetUnit , speed , Effect_MirrorImageCaster , 0 , Effect_red_shatter )
	endfunction
	private function talent_ghost_walk takes nothing returns nothing	//鬼步
		local unit u = GetTriggerUnit()
	    local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	    local location loc = null
	    local location targetLoc = null
	    local real distance = 100 + I2R(level) * 20
	    call PolledWait(0.01)
	    set loc = GetUnitLoc(u)
	    set targetLoc = PolarProjectionBJ( loc , distance , GetUnitFacing(u)+180 )
	    call funcs_effectPoint( Effect_MirrorImageCaster , loc )
	    call funcs_effectPoint( Effect_MirrorImageCaster , targetLoc )
	    call SetUnitPositionLoc( u , targetLoc )
	    call RemoveLocation(loc)
	    call RemoveLocation(targetLoc)
	endfunction
	private function talent_action takes nothing returns nothing
		local integer abilityId = GetSpellAbilityId()
		if( abilityId == m1_SPELL_Talent_Eagle_Eye ) then
			call talent_eagle_eye()
		elseif( abilityId == m1_SPELL_Talent_Charge ) then
			call talent_charge()
		elseif( abilityId == m1_SPELL_Talent_Jump ) then
			call talent_jump()
		elseif( abilityId == m1_SPELL_Talent_Ghost_Walk ) then
			call talent_ghost_walk()
		endif
	endfunction
	private function initTelent takes nothing returns nothing
		local trigger triggerTalent = CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ( triggerTalent , EVENT_PLAYER_UNIT_SPELL_EFFECT )
	    call TriggerAddAction( triggerTalent , function talent_action )
	endfunction

	/* 活力/魔法恢复 */
	private function initlifeManaBack takes nothing returns nothing
	    local timer t = GetExpiredTimer()
	    local real period = TimerGetTimeout(t)
	    local integer i = 1
	    //恢复活力/魔法
	    loop
	        exitwhen i > Max_Player_num
	        if ((Player_heros[i] != null) and (IsUnitAliveBJ(Player_heros[i]) == true) and (GetPlayerSlotState(Players[i]) == PLAYER_SLOT_STATE_PLAYING)) then
	            call SetUnitLifeBJ( Player_heros[i], ( GetUnitStateSwap(UNIT_STATE_LIFE, Player_heros[i]) + ( Attr_LifeBack[i] * period ) ) )
	            call SetUnitManaBJ( Player_heros[i], ( GetUnitStateSwap(UNIT_STATE_MANA, Player_heros[i]) + ( Attr_ManaBack[i] * period ) ) )
	        endif
	        set i = i + 1
	    endloop
	endfunction

	/* 硬直恢复器(+30/2s) */
	private function initPunishBack takes nothing returns nothing
	    local integer i
	    local integer addPunish = 0
	    set i = 1
	    loop
	        exitwhen i > Max_Player_num
	        if ((Player_heros[i] != null) and (IsUnitAliveBJ(Player_heros[i]) == true) and (GetPlayerSlotState(Players[i]) == PLAYER_SLOT_STATE_PLAYING)) then
	            set addPunish = Attr_PunishCurrent[i] + 30
	            if(addPunish > Attr_PunishFull[i]) then
	                set addPunish = Attr_PunishFull[i]
	            endif
	            set Attr_PunishCurrent[i] = addPunish
	            call attribute_freshStr(i)
	        endif
	        set i = i + 1
	    endloop
	endfunction


	/* 触发action - 英雄升级 */
	private function triggerHeroLevelUpAction takes nothing returns nothing
		local integer j
	    local unit u = GetTriggerUnit()
	    local integer index = GetConvertedPlayerId(GetOwningPlayer(u))
	    local integer newlevel = GetUnitLevel(u)
	    local integer oldLevel = Player_heros_level[index]
	    local integer points = 0
	    //技能点给予
	    if( newlevel <=  Last_skillPointsLv) then
	        set j = oldLevel + 1
	        loop
	            exitwhen j> newlevel
	            	//等于特定等级才获得技能点
                    if (j == 2 or j == 3 or j ==5 or j == 10 or j == 15) then
                        set points = points + 1
                    elseif(j == 20 or j == 25 or j == 30 or j == 35) then
                        set points = points + 1
                    elseif(j == 40 or j == 45 or j == 50 or j == 55) then
                        set points = points + 1
                    elseif(j == 60 or j == 65  or j == 70 or j == 75) then
                        set points = points + 1
                    elseif(j == 80 or j == 85  or j == 90 or j == 100) then
                        set points = points + 1
                    elseif(j == 150 or j == 200  or j == 250 or j == 300) then
                        set points = points + 1
                    endif
	            set j = j + 1
	        endloop
	    endif
	    set Player_heros_level[index] = newlevel
	    set Player_heros_skillPoints[index] =  Player_heros_skillPoints[index] + points
	    call ModifyHeroSkillPoints( u, bj_MODIFYMETHOD_SET, Player_heros_skillPoints[index] )
	    //整体属性计算
	    call attribute_calculateOne(index)
	endfunction

	/* 触发action - 英雄学习技能 */
	private function triggerHeroStudySkillAction takes nothing returns nothing
		local integer index = GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))
    	set Player_heros_skillPoints[index] = Player_heros_skillPoints[index] - 1
	endfunction

	/* 触发action - 英雄MH */
	private function triggerMHAttackAction takes nothing returns nothing
		if((IsUnitAlly(GetAttacker(), GetOwningPlayer(GetTriggerUnit())) == true) and (GetPlayerController(GetOwningPlayer(GetTriggerUnit())) == MAP_CONTROL_USER) and (GetUnitLifePercent(GetTriggerUnit()) > 10.00))then
			call IssueImmediateOrder( GetAttacker(), "stop" )
		endif
	endfunction

	/* 触发action - 英雄APM */
	private function triggerApmAction takes nothing returns nothing
	    set Apm[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] = Apm[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] + 1
	endfunction

	/* 触发额外 - 英雄jesusCD */
	private function heroDeathJesusCD takes nothing returns nothing
        local timer t = GetExpiredTimer()
        local unit hero = funcs_getTimerParams_Unit( t , Key_Skill_Unit )
        call SaveBoolean(HASH_Hero,Key_Hash_Tomb_Jesus,GetHandleId(hero),false)
        call funcs_delTimer(t,null)
    endfunction

	/* 触发action - 英雄死亡 */
	private function triggerHeroDeathAction takes nothing returns nothing
	    local unit hero = GetTriggerUnit()
	    local integer index = GetConvertedPlayerId(GetOwningPlayer(hero))
	    local location point = null
	    local unit tomb
	    local unit tombView
	    local integer i = 0
	    local boolean isAllOver = TRUE
	    local timer t = null
	    local real jesusQty = 0
	    local real jesusCountDown = 0
	    if((IsUnitIllusionBJ(GetTriggerUnit()) == false) and (IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) == true) and (GetOwningPlayer(GetTriggerUnit()) != Player(PLAYER_NEUTRAL_PASSIVE)))then
			//TODO 检测是否拥有Jesus
			/*
		    if( funcs_isOwnItem(hero , ITEM_jesus) and LoadBoolean(HASH_Hero,Key_Hash_Tomb_Jesus,GetHandleId(hero))==false ) then
		        set jesusQty = items_getItemCharges(hero,ITEM_jesus)
		        set jesusCountDown = 250
		        set i = 1
		        loop
		            exitwhen i >= jesusQty
		                set jesusCountDown = jesusCountDown * 0.95
		            set i = i +1
		        endloop
		        call SaveBoolean(HASH_Hero,Key_Hash_Tomb_Jesus,GetHandleId(hero),true)
		        set t = funcs_setTimeout( jesusCountDown , function heroDeathJesusCD )
		        call funcs_setTimerParams_Unit( t , Key_Skill_Unit , hero )
		        call funcs_floatMsg( "|cffffff00英雄复活！|r" ,  hero  )
		        set point = GetUnitLoc(hero)
		        call funcs_effectPoint( Effect_ReviveHuman , point )
		        call ReviveHeroLoc( hero , point , true )
		        call RemoveLocation( point )
		        return
		    endif
		    */
		    //设置玩家死亡状态为【已死】
		    set Player_heros_isDead[index] = true
		    //TODO 设置玩家滤镜为红色
		    if(GetOwningPlayer(hero) == GetLocalPlayer()) then
		        call CinematicFilterGenericBJ( 3.00, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\DreamFilter_Mask.blp", 100, 0.00, 0.00, 100, 100.00, 0, 0, 20.00 )
		    endif
		    set i = 1
		    loop
		        exitwhen i > Max_Player_num
		            if ( Player_heros_isDead[i] == false ) then
		                set isAllOver = false
		                call DoNothing() YDNL exitwhen true
		            endif
		        set i = i + 1
		    endloop
		    if ( isAllOver == true ) then
		        //团灭
		        call DisableTrigger( GetTriggeringTrigger() )
		        call lose_setLoseTitle("敌人势猛！英雄兵败！")
		        call lose_setLoseTips("在激烈地的交战战况下，你们团灭，兵败于此！")
		        call lose_actionAll()
		    else
		        //墓碑
		        //创建墓碑视野1个
		        set point = GetUnitLoc(hero)
		        set tombView = funcs_createUnit( GetOwningPlayer(hero) , Unit_TombView, point, null )
		        set Player_heros_tomb_views[index] = tombView
		        //创建墓碑1个
		        set tomb = funcs_createUnit( Player_Enemy , Unit_Tomb, point, null )
		        set Player_heros_tombs[index] = tomb
		        call eventRegist_unitDamaged( m1_Trigger_HeroTomb , tomb ) 	//注册[墓碑伤害 | 英雄被救]事件
		        call eventRegist_unitDeath( m1_Trigger_HeroReborn , tomb ) 	//注册[墓碑死亡 | 英雄复活]事件
		        call SaveInteger(HASH, GetHandleId(tomb), Key_Hash_Tomb_Index, index)
		        call SaveUnitHandle(HASH, GetHandleId(tomb), Key_Hash_Tomb_ViewUnit, tombView)
		        call SaveUnitHandle(HASH, GetHandleId(tomb), Key_Hash_Tomb_Hero, GetTriggerUnit())
		        call RemoveLocation( point )
		        call funcs_print("一位英雄死掉了！他的碑塔正在这荒原大地耸立！")
		        //改变玩家状态
		        call funcs_setBattleStatus2Death( GetOwningPlayer(hero) )
		    endif
    	endif
	endfunction

	/* 触发action - 英雄被救 - callback */
	private function triggerHeroTombCallBack takes nothing returns nothing
		local timer t = GetExpiredTimer()
	    local integer index = funcs_getTimerParams_Integer(t,Key_Hash_Tomb_Index)
	    set Reborn_tombs_status[index] = false
	    call funcs_delTimer(t,null)
	endfunction

	/* 触发action - 英雄被救 */
	private function triggerHeroTombAction takes nothing returns nothing
	    local timer t = null
	    local unit u = GetTriggerUnit()
	    local integer index = GetConvertedPlayerId(GetOwningPlayer(GetEventDamageSource()))
	    if( isHero(GetEventDamageSource()) and (IsUnitAliveBJ(u) == true) and (GetEventDamage() > 1) ) then //如果是英雄
	        if ( Reborn_tombs_status[index] == false ) then
	            //先要处于可以被拯救的状态 即Reborn_tombs_status == false
	            set Reborn_tombs_status[index] = true
	            set t = funcs_setTimeout( 1.00 ,function triggerHeroTombCallBack)
	            call funcs_setTimerParams_Integer(t,Key_Hash_Tomb_Index,index)
	            call SetUnitLifeBJ( u, ( GetUnitStateSwap(UNIT_STATE_LIFE, u) - I2R(Attr_Help[index]) ) )
	            call funcs_floatMsg( "救助 "+I2S(Attr_Help[index]) , u)
	        else
	            call skills_avoid( u )
	            if( Attr_AttackSpeed[index] > 50 )then
	                call attribute_changeAttribute( Tag_AttackSpeed ,index, -50 , 1.0 )
	            endif
	        endif
	    endif
	endfunction

	/* 触发action - 英雄复活 */
	private function triggerHeroRebornAction takes nothing returns nothing
		local integer tombHandleId = GetHandleId(GetTriggerUnit())
	    local location point = GetUnitLoc(GetTriggerUnit())
	    local integer index = LoadInteger(HASH, tombHandleId, Key_Hash_Tomb_Index)
	    local unit hero = LoadUnitHandle(HASH , tombHandleId, Key_Hash_Tomb_Hero)
	    local unit tombView = LoadUnitHandle(HASH , tombHandleId, Key_Hash_Tomb_ViewUnit)
	    local integer tombTecLv = GetPlayerTechCountSimple( CurrentGameTecTomb , Player_Enemy )
	    if(GetPlayerSlotState( Players[index] ) == PLAYER_SLOT_STATE_PLAYING and GetUnitTypeId(GetTriggerUnit()) == Unit_Tomb) then
	        set Player_heros_isDead[index] = FALSE
	        call ReviveHeroLoc( Player_heros[index], point, true )
	        //设置玩家状态回战斗中
	        call funcs_setBattleStatus2Battle( GetOwningPlayer(hero) )
	        call RemoveUnit( tombView )
	        call RemoveUnit( GetTriggerUnit() )
	        call RemoveLocation( point )
	        //设置墓碑难度上升
	        if( CurrentGameTecTomb < 100) then
	            call SetPlayerTechResearchedSwap( CurrentGameTecTomb ,  tombTecLv+1 , Player_Enemy )
	        endif
	        //设置玩家滤镜为无
	        if(GetOwningPlayer(hero) == GetLocalPlayer()) then
	            call DisplayCineFilter( false )
	        endif
	        //重算一下属性
	        call attribute_calculateOne(index)
	        //给予复活英雄1.5秒无敌
	        call skills_invulnerable( Player_heros[index] , 1.50 )
	    else
	        call RemoveUnit( tombView )
	        call funcs_print("然而已经人去碑空~~")
	    endif
	endfunction



	/* 触发绑定 - 英雄 */
	public function triggerHeroBind takes unit hero returns nothing
		call TriggerRegisterUnitEvent( m1_Trigger_HeroLevelUp , hero , EVENT_UNIT_HERO_LEVEL )		//提升等级
	 	call TriggerRegisterUnitEvent( m1_Trigger_HeroStudySkill , hero , EVENT_UNIT_HERO_SKILL )		//学习技能
	 	call TriggerRegisterUnitEvent( m1_Trigger_HeroDeath, hero, EVENT_UNIT_DEATH )				//英雄死亡
	 	call TriggerRegisterUnitEvent( m1_Trigger_MHAttack , hero, EVENT_UNIT_ATTACKED )			//攻击MH
	 	call TriggerRegisterUnitEvent( m1_Trigger_HeroApm, hero, EVENT_UNIT_ISSUED_TARGET_ORDER )	//APM
	    call TriggerRegisterUnitEvent( m1_Trigger_HeroApm, hero, EVENT_UNIT_ISSUED_POINT_ORDER )
	    call TriggerRegisterUnitEvent( m1_Trigger_HeroApm, hero, EVENT_UNIT_ISSUED_ORDER )
	 	call eventRegist_unitDamaged( m1_Trigger_BeDamaged , hero )									//受伤事件
	 	call eventRegist_unitDamaged( m1_Trigger_BeAttacked , hero )									//受攻事件
	 	call eventRegist_unitDamaged( m1_Trigger_BeSpelled , hero )									//受技事件
	endfunction










	/* 设定 */
	public function init takes nothing returns nothing

		//天赋技能
		call initTelent()

		//英雄数据
		call initHero()

		//酒馆
		call initDrunkery()

		//开启生命/魔法恢复
		call funcs_setInterval(0.35,function initlifeManaBack)

		//开启硬直恢复
    	call funcs_setInterval(2.00,function initPunishBack)

    	//触发
    	set m1_Trigger_MHAttack = CreateTrigger()
    	set m1_Trigger_HeroLevelUp = CreateTrigger()
	 	set m1_Trigger_HeroStudySkill = CreateTrigger()
	 	set m1_Trigger_HeroApm = CreateTrigger()
	 	set m1_Trigger_HeroDeath = CreateTrigger()
	 	set m1_Trigger_HeroTomb = CreateTrigger()
	 	set m1_Trigger_HeroReborn = CreateTrigger()

		call TriggerAddAction( m1_Trigger_MHAttack , function triggerMHAttackAction )
		call TriggerAddAction( m1_Trigger_HeroLevelUp , function triggerHeroLevelUpAction )
		call TriggerAddAction( m1_Trigger_HeroStudySkill , function triggerHeroStudySkillAction )
		call TriggerAddAction( m1_Trigger_HeroApm , function triggerApmAction )
		call TriggerAddAction( m1_Trigger_HeroDeath , function triggerHeroDeathAction )
    	call TriggerAddAction( m1_Trigger_HeroTomb, function triggerHeroTombAction)
    	call TriggerAddAction( m1_Trigger_HeroReborn, function triggerHeroRebornAction)

	endfunction

endlibrary

//死亡骑士
#include "hero/deathKnight.j"
//霹雳
#include "hero/thunderbolt.j"
//捍卫骑士
#include "hero/protectKnight.j"
//地穴甲虫
#include "hero/cryptBeetle.j"
//召唤师
#include "hero/kael.j"
//恶魔猎手
#include "hero/demonHunter.j"
//影刺客
#include "hero/arcaneHunter.j"
//暗杀者
#include "hero/assassin.j"
//山丘之王
#include "hero/mountainKing.j"
//撼地蛮牛
#include "hero/shakeBull.j"
//逸风
#include "hero/wind.j"
//美杜莎
#include "hero/medusa.j"
//德鲁伊法尔
#include "hero/druidFarre.j"
//无双
#include "hero/unparalleled.j"
